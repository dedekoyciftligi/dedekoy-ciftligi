<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DedekÃ¶y Ã‡iftliÄŸi</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
header{
background:linear-gradient(90deg,#6a1b9a,#4527a0);
color:white;padding:18px;text-align:center;
font-size:20px;font-weight:bold
}
nav{
display:flex;justify-content:space-around;
background:white;padding:10px;
box-shadow:0 2px 8px rgba(0,0,0,0.1)
}
nav button{
background:none;border:none;font-weight:bold
}
.container{padding:15px}
.card{
background:white;padding:15px;border-radius:12px;
margin-bottom:15px;
box-shadow:0 3px 10px rgba(0,0,0,0.08)
}
input{
width:100%;padding:10px;margin-top:6px;
border-radius:6px;border:1px solid #ccc
}
button.action{
margin-top:8px;padding:10px;width:100%;
background:#5e35b1;color:white;border:none;
border-radius:8px
}
.listItem{
padding:10px;border-bottom:1px solid #eee;
cursor:pointer
}
.listItem:hover{background:#f1f1f1}
.kesim{border-left:5px solid red;padding-left:10px}
.hidden{display:none}
#reader{width:100%}
</style>
</head>

<body>

<header>ğŸ„ DedekÃ¶y Ã‡iftliÄŸi YÃ¶netim</header>

<nav>
<button onclick="panel('home')">Ana Sayfa</button>
<button onclick="panel('liste')">Liste</button>
<button onclick="panel('ekle')">Yeni Ekle</button>
<button onclick="panel('qr')">QR Tara</button>
</nav>

<div class="container">

<!-- ANA SAYFA -->
<div id="homePanel">
<div class="card">
<h3>TÃ¼r SayÄ±larÄ±</h3>
<div id="turKartlari"></div>
</div>

<div class="card">
<h3>Kesime Gidenler</h3>
<div id="kesimListe"></div>
</div>
</div>

<!-- LÄ°STE -->
<div id="listePanel" class="hidden">
<div class="card">
<h3>TÃ¼m Hayvanlar</h3>
<div id="liste"></div>
</div>
</div>

<!-- EKLE -->
<div id="eklePanel" class="hidden">
<div class="card">
<h3>Yeni Hayvan Ekle</h3>

QR ID
<input id="qr">

KÃ¼pe No
<input id="kupe">

TÃ¼r
<input id="tur">

Ä°lk Kilo
<input id="kilo" type="number">

<button class="action" onclick="hayvanEkle()">Kaydet</button>

</div>
</div>

<!-- QR -->
<div id="qrPanel" class="hidden">
<div class="card">
<h3>QR Kamera</h3>
<div id="reader"></div>
<button class="action" onclick="kamerayiKapat()">KamerayÄ± Kapat</button>
</div>
</div>

<!-- DETAY -->
<div id="detayPanel" class="hidden">
<div class="card" id="detay"></div>
</div>

</div>

<script>

const API="https://script.google.com/macros/s/AKfycbwUhg_knEiRUulKxjzbdVRQXX6qFa9ypzhkUDCV8miaoOnggHvr4ADLMeTvSR6H0XA_/exec";

/* PANEL */
function panel(p){
homePanel.classList.add("hidden");
listePanel.classList.add("hidden");
eklePanel.classList.add("hidden");
qrPanel.classList.add("hidden");
detayPanel.classList.add("hidden");

if(p=="home") homePanel.classList.remove("hidden");
if(p=="liste"){listePanel.classList.remove("hidden");listeYukle();}
if(p=="ekle") eklePanel.classList.remove("hidden");
if(p=="qr"){qrPanel.classList.remove("hidden");kameraBaslat();}
}

/* DASHBOARD */
async function dashboard(){
const r=await fetch(API,{method:"POST",body:JSON.stringify({tip:"tumHayvanlar"})});
const data=await r.json();

let turler={};
let kesimHTML="";

data.forEach(h=>{

if(!turler[h.tur]) turler[h.tur]=0;
turler[h.tur]++;

if(h.durum=="KESIM"){
kesimHTML+=`
<div class="kesim">
<b>${h.qr}</b> (${h.tur})<br>
${h.ilkKilo} â†’ ${h.sonKilo} kg
</div><br>`;
}

});

let turHTML="";
for(let t in turler){
turHTML+=`${t}: <b>${turler[t]}</b><br>`;
}

turKartlari.innerHTML=turHTML;
kesimListe.innerHTML=kesimHTML;
}

/* LÄ°STE */
async function listeYukle(){
const r=await fetch(API,{method:"POST",body:JSON.stringify({tip:"tumHayvanlar"})});
const data=await r.json();

let html="";
data.forEach(h=>{
html+=`
<div class="listItem" onclick="detayGoster('${h.qr}')">
<b>${h.qr}</b> (${h.tur}) - ${h.sonKilo} kg
</div>`;
});

liste.innerHTML=html;
}

/* DETAY */
async function detayGoster(qr){
const r=await fetch(API,{method:"POST",body:JSON.stringify({tip:"hayvanGetir",qr:qr})});
const h=await r.json();

detayPanel.classList.remove("hidden");

detay.innerHTML=`
<h3>${h.qr}</h3>
TÃ¼r: ${h.tur}<br>
KÃ¼pe: ${h.kupe}<br>
Ä°lk Kilo: ${h.ilkKilo}<br>
Son Kilo: ${h.sonKilo}<br>
Durum: ${h.durum}<br><br>

Yeni Kilo
<input id="yeniKilo" type="number">
<button class="action" onclick="kiloGuncelle('${h.qr}')">Kilo GÃ¼ncelle</button>
`;
}

/* KÄ°LO GÃœNCELLE */
async function kiloGuncelle(qr){
let kilo=document.getElementById("yeniKilo").value;

await fetch(API,{
method:"POST",
body:JSON.stringify({tip:"kiloGuncelle",qr:qr,kilo:kilo})
});

alert("GÃ¼ncellendi");
panel("home");
dashboard();
}

/* EKLE */
async function hayvanEkle(){
await fetch(API,{
method:"POST",
body:JSON.stringify({
tip:"hayvanEkle",
qr:qr.value,
kupe:kupe.value,
tur:tur.value,
kilo:kilo.value
})
});
alert("Eklendi");
panel("home");
dashboard();
}

/* QR */
let html5Qr;

function kameraBaslat(){
html5Qr=new Html5Qrcode("reader");
html5Qr.start(
{facingMode:"environment"},
{fps:10,qrbox:250},
(qrCodeMessage)=>{
kamerayiKapat();
detayGoster(qrCodeMessage);
});
}

function kamerayiKapat(){
if(html5Qr){
html5Qr.stop().then(()=>{});
}
qrPanel.classList.add("hidden");
homePanel.classList.remove("hidden");
}

dashboard();

</script>

</body>
</html>
