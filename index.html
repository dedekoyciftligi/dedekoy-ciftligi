<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√áiftlik Y√∂netimi</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{margin:0;font-family:Arial;background:#f2f3f7}
header{
background:linear-gradient(90deg,#7b1fa2,#512da8);
color:white;padding:20px;text-align:center;font-size:20px;font-weight:bold
}
.container{padding:15px;padding-bottom:80px}

.cards{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
margin-bottom:15px
}

.cardBox{
color:white;padding:20px;border-radius:16px;
font-size:18px;font-weight:bold;
box-shadow:0 4px 12px rgba(0,0,0,0.15)
}

.section{
background:white;border-radius:16px;padding:15px;
margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.08)
}

.item{
background:#fafafa;padding:12px;
border-radius:12px;margin-bottom:10px;
border-left:6px solid #ccc
}

.kesimItem{border-left:6px solid red}

button{
padding:12px;width:100%;margin-top:8px;
background:#673ab7;color:white;
border:none;border-radius:8px
}

input{
width:100%;padding:10px;margin-top:6px;
border-radius:6px;border:1px solid #ccc
}

.bottomNav{
position:fixed;bottom:0;left:0;right:0;
background:white;display:flex;
justify-content:space-around;
padding:10px 0;
box-shadow:0 -2px 8px rgba(0,0,0,0.1)
}

.bottomNav button{
background:none;border:none;font-size:14px
}

.hidden{display:none}
#reader{width:100%;margin-top:10px}
</style>
</head>

<body>

<header>üêë √áiftlik Y√∂netimi</header>

<div class="container">

<!-- ANA SAYFA -->
<div id="homePanel">
<div class="cards" id="turKartlari"></div>

<div class="section">
<h3>üìâ Kesime Gidenler</h3>
<div id="kesimListe"></div>
</div>
</div>

<!-- Lƒ∞STE PANEL -->
<div id="listePanel" class="hidden">
<div class="section">
<h3>T√ºm Hayvanlar</h3>
<div id="liste"></div>
</div>
</div>

<!-- QR PANEL -->
<div id="qrPanel" class="hidden">
<h3>QR Tara</h3>
<div id="reader"></div>
<button onclick="kamerayiKapat()">QR Kapat</button>
</div>

<!-- EKLE PANEL -->
<div id="eklePanel" class="hidden">
<h3>Hayvan Ekle</h3>
<input id="qr" placeholder="QR_ID">
<input id="kupe" placeholder="K√ºpe No">
<input id="tur" placeholder="T√ºr">
<input id="kilo" type="number" placeholder="ƒ∞lk Kilo">
<button onclick="hayvanEkle()">Kaydet</button>
</div>

<!-- KART PANEL -->
<div id="kartPanel" class="hidden section"></div>

</div>

<div class="bottomNav">
<button onclick="panelAc('home')">Ana</button>
<button onclick="panelAc('liste')">Liste</button>
<button onclick="panelAc('qr')">Tara</button>
<button onclick="panelAc('ekle')">Ekle</button>
</div>

<script>

const API="https://script.google.com/macros/s/AKfycbwUhg_knEiRUulKxjzbdVRQXX6qFa9ypzhkUDCV8miaoOnggHvr4ADLMeTvSR6H0XA_/exec";
let html5Qr;

/* PANEL */
function panelAc(p){
homePanel.classList.add("hidden");
listePanel.classList.add("hidden");
qrPanel.classList.add("hidden");
eklePanel.classList.add("hidden");
kartPanel.classList.add("hidden");

if(p=="home") homePanel.classList.remove("hidden");
if(p=="liste"){listePanel.classList.remove("hidden");listeYukle();}
if(p=="qr"){qrPanel.classList.remove("hidden");kamerayiBaslat();}
if(p=="ekle") eklePanel.classList.remove("hidden");
}

/* DASHBOARD */
async function dashboard(){
const res=await fetch(API,{method:"POST",body:JSON.stringify({tip:"tumHayvanlar"})});
const data=await res.json();

let turSayilari={};
let kesimHTML="";

data.forEach(h=>{

if(!turSayilari[h.tur]) turSayilari[h.tur]=0;
turSayilari[h.tur]++;

if(h.durum=="KESIM"){
kesimHTML+=`
<div class="item kesimItem">
<b>${h.qr}</b><br>
${h.ilkKilo} kg ‚Üí ${h.sonKilo} kg
</div>`;
}
});

let kartHTML="";
for(let tur in turSayilari){
kartHTML+=`
<div class="cardBox" style="background:linear-gradient(135deg,#1976d2,#512da8)">
${tur}<br>${turSayilari[tur]}
</div>`;
}

turKartlari.innerHTML=kartHTML;
kesimListe.innerHTML=kesimHTML;
}

/* Lƒ∞STE */
async function listeYukle(){
const res=await fetch(API,{method:"POST",body:JSON.stringify({tip:"tumHayvanlar"})});
const data=await res.json();

let html="";
data.forEach(h=>{
html+=`
<div class="item" onclick="hayvanGetir('${h.qr}')">
<b>${h.qr}</b> (${h.tur})<br>
ƒ∞lk: ${h.ilkKilo} | Son: ${h.sonKilo}
</div>`;
});

liste.innerHTML=html;
}

/* HAYVAN GETƒ∞R */
async function hayvanGetir(qr){
const res=await fetch(API,{method:"POST",body:JSON.stringify({tip:"hayvanGetir",qr:qr})});
const h=await res.json();

if(!h) return;

kartPanel.classList.remove("hidden");
kartPanel.innerHTML=`
<h3>${h.qr}</h3>
T√ºr: ${h.tur}<br>
K√ºpe: ${h.kupe}<br>
ƒ∞lk Kilo: ${h.ilkKilo}<br>
Son Kilo: ${h.sonKilo}<br>
Durum: ${h.durum}<br>
<input id="yeniKilo" type="number" placeholder="Yeni Kilo">
<button onclick="kiloGuncelle('${h.qr}')">Kilo G√ºncelle</button>
`;
}

/* Kƒ∞LO G√úNCELLE */
async function kiloGuncelle(qr){
let kilo=document.getElementById("yeniKilo").value;

await fetch(API,{
method:"POST",
body:JSON.stringify({tip:"kiloGuncelle",qr:qr,kilo:kilo})
});

alert("G√ºncellendi");
dashboard();
panelAc("home");
}

/* QR */
function kamerayiBaslat(){
html5Qr=new Html5Qrcode("reader");
html5Qr.start(
{ facingMode:"environment" },
{ fps:10, qrbox:250 },
(qrCodeMessage)=>{
kamerayiKapat();
hayvanGetir(qrCodeMessage);
}
);
}

function kamerayiKapat(){
if(html5Qr){
html5Qr.stop().then(()=>{});
}
qrPanel.classList.add("hidden");
homePanel.classList.remove("hidden");
}

/* EKLE */
async function hayvanEkle(){
await fetch(API,{
method:"POST",
body:JSON.stringify({
tip:"hayvanEkle",
qr:qr.value,
kupe:kupe.value,
tur:tur.value,
kilo:kilo.value
})
});
alert("Kaydedildi");
dashboard();
panelAc("home");
}

dashboard();

</script>

</body>
</html>
