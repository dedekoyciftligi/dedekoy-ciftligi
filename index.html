<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dedeköy Çiftliği Yönetim</title>

<style>
body{margin:0;font-family:Arial;background:#eef2f1}
header{background:#1b5e20;color:white;padding:18px;text-align:center;font-size:22px;font-weight:bold}
.container{padding:15px;max-width:900px;margin:auto}
.card{background:white;margin-bottom:15px;padding:18px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
button{padding:10px;width:100%;margin-top:8px;background:#2e7d32;color:white;border:none;border-radius:8px;cursor:pointer}
button:hover{background:#1b5e20}
input{width:100%;padding:9px;margin-top:6px;border-radius:6px;border:1px solid #ccc}
.list-item{padding:12px;border-bottom:1px solid #eee;cursor:pointer}
.list-item:hover{background:#f5f5f5}
.kesim{color:red;font-weight:bold}
.besi{color:green;font-weight:bold}
.hidden{display:none}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
h3{margin-top:0}
.small{font-size:13px;color:#666}
.badge{padding:4px 8px;border-radius:6px;font-size:12px}
.badge-green{background:#e8f5e9;color:#2e7d32}
.badge-red{background:#ffebee;color:#c62828}
</style>
</head>

<body>

<header>DEDEKÖY ÇİFTLİĞİ YÖNETİM</header>

<div class="container">

<!-- DASHBOARD -->
<div class="card">
<h3>Genel Durum</h3>
<div><b>Toplam Aktif Hayvan:</b> <span id="toplam">0</span></div>
<div id="turler"></div>
</div>

<!-- HAYVAN EKLE -->
<div class="card">
<h3>Hayvan Ekle</h3>
<div class="grid">
<input id="qr" placeholder="QR_ID">
<input id="kupe" placeholder="Küpe No">
<input id="tur" placeholder="Tür (İnek, Dana...)">
<input id="kilo" type="number" placeholder="İlk Kilo">
</div>
<button onclick="hayvanEkle()">Hayvan Ekle</button>
</div>

<!-- ARAMA -->
<div class="card">
<h3>Hayvan Ara</h3>
<input id="qrAra" placeholder="QR ile ara">
<button onclick="qrAra()">QR Ara</button>

<input id="kupeAra" placeholder="Küpe No ile ara">
<button onclick="kupeAra()">Küpe Ara</button>
</div>

<!-- LİSTE -->
<div class="card">
<h3>Tüm Hayvanlar</h3>
<div id="liste"></div>
</div>

<!-- KESİM LİSTESİ -->
<div class="card">
<h3>Kesime Gidecekler</h3>
<div id="kesimListe"></div>
</div>

<!-- KART -->
<div id="kart" class="card hidden"></div>

</div>

<script>

const API="https://script.google.com/macros/s/AKfycbwUhg_knEiRUulKxjzbdVRQXX6qFa9ypzhkUDCV8miaoOnggHvr4ADLMeTvSR6H0XA_/exec";

/* DASHBOARD */
async function dashboard(){
const res=await fetch(API,{method:"POST",body:JSON.stringify({tip:"dashboard"})});
const data=await res.json();

document.getElementById("toplam").innerText=data.toplam;

let html="";
for(let t in data.turler){
html+=`<div>${t}: ${data.turler[t]}</div>`;
}
document.getElementById("turler").innerHTML=html;
}

/* EKLE */
async function hayvanEkle(){
await fetch(API,{
method:"POST",
body:JSON.stringify({
tip:"hayvanEkle",
qr:qr.value,
kupe:kupe.value,
tur:tur.value,
kilo:kilo.value
})
});
alert("Eklendi");
liste();
dashboard();
}

/* LİSTE */
async function liste(){
const res=await fetch(API,{method:"POST",body:JSON.stringify({tip:"tumHayvanlar"})});
const data=await res.json();

let html="";
let kesimHtml="";

data.forEach(h=>{

let durumClass=h.durum=="KESIM"?"kesim":"besi";

let kart=`
<div class="list-item" onclick='kartGoster(${JSON.stringify(h)})'>
<b>${h.qr}</b> | Küpe: ${h.kupe}<br>
Tür: ${h.tur}<br>
İlk: ${h.ilkKilo} kg | Son: ${h.sonKilo} kg<br>
Fark: ${h.fark} kg<br>
<span class="${durumClass}">${h.durum}</span>
</div>`;

html+=kart;

if(h.durum=="KESIM"){
kesimHtml+=kart;
}
});

document.getElementById("liste").innerHTML=html;
document.getElementById("kesimListe").innerHTML=kesimHtml;
}

/* KART */
function kartGoster(h){
document.getElementById("kart").classList.remove("hidden");

document.getElementById("kart").innerHTML=`
<h3>Hayvan Kartı</h3>
QR: ${h.qr}<br>
Küpe: ${h.kupe}<br>
Tür: ${h.tur}<br>
İlk Kilo: ${h.ilkKilo}<br>
Son Kilo: ${h.sonKilo}<br>
Fark: ${h.fark}<br>
Durum: ${h.durum}<br>
Son Aşı: ${h.sonAsi}<br>
Sonraki Aşı: ${h.sonrakiAsi}

<hr>

<h4>Kilo Güncelle</h4>
<input id="yeniKilo" type="number" placeholder="Yeni Kilo">
<button onclick="kiloGuncelle('${h.qr}')">Güncelle</button>

<h4>Aşı Güncelle</h4>
<input id="sonAsi" type="date">
<input id="sonrakiAsi" type="date">
<button onclick="asiGuncelle('${h.qr}')">Aşı Güncelle</button>
`;
}

/* KİLO */
async function kiloGuncelle(qr){
await fetch(API,{
method:"POST",
body:JSON.stringify({
tip:"kiloGuncelle",
qr:qr,
kilo:yeniKilo.value
})
});
alert("Kilo Güncellendi");
liste();
dashboard();
}

/* AŞI */
async function asiGuncelle(qr){
await fetch
