<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√áiftlik Mobil App</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
margin:0;
font-family:Arial;
background:#f2f3f7;
}

header{
background:linear-gradient(90deg,#7b1fa2,#512da8);
color:white;
padding:20px;
text-align:center;
font-size:20px;
font-weight:bold;
}

.container{padding:15px}

.cards{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
margin-bottom:15px;
}

.cardBox{
color:white;
padding:20px;
border-radius:16px;
font-size:18px;
font-weight:bold;
box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.total{background:linear-gradient(135deg,#9c27b0,#673ab7)}
.koyun{background:linear-gradient(135deg,#1976d2,#1565c0)}
.koc{background:linear-gradient(135deg,#2e7d32,#1b5e20)}
.kuzu{background:linear-gradient(135deg,#f57c00,#e65100)}

.section{
background:white;
border-radius:16px;
padding:15px;
margin-bottom:15px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.section h3{margin-top:0}

.item{
background:#fafafa;
padding:12px;
border-radius:12px;
margin-bottom:10px;
border-left:6px solid #ccc;
}

.kesimItem{border-left:6px solid red}
.asiItem{border-left:6px solid orange}

.bottomNav{
position:fixed;
bottom:0;
left:0;
right:0;
background:white;
display:flex;
justify-content:space-around;
padding:10px 0;
box-shadow:0 -2px 8px rgba(0,0,0,0.1);
}

.bottomNav button{
background:none;
border:none;
font-size:14px;
}

.hidden{display:none}

#reader{
width:100%;
margin-top:10px;
}
</style>
</head>

<body>

<header>üêë √áiftlik Y√∂netimi</header>

<div class="container">

<!-- ANA SAYFA -->
<div id="homePanel">

<div class="cards">
<div class="cardBox total">
Toplam<br><span id="toplam">0</span>
</div>

<div class="cardBox koyun">
Koyun<br><span id="koyun">0</span>
</div>

<div class="cardBox koc">
Ko√ß<br><span id="koc">0</span>
</div>

<div class="cardBox kuzu">
Kuzu<br><span id="kuzu">0</span>
</div>
</div>

<div class="section">
<h3>üìâ Kesime Uygun Hayvanlar</h3>
<div id="kesimListe"></div>
</div>

<div class="section">
<h3>üìÖ Yakla≈üan A≈üƒ±lar</h3>
<div id="asiListe"></div>
</div>

</div>

<!-- QR PANEL -->
<div id="qrPanel" class="hidden">
<h3>QR Tara</h3>
<div id="reader"></div>
<button onclick="kamerayiKapat()">QR Kapat</button>
</div>

<!-- EKLE PANEL -->
<div id="eklePanel" class="hidden">
<h3>Hayvan Ekle</h3>
<input id="qr" placeholder="QR_ID"><br><br>
<input id="kupe" placeholder="K√ºpe No"><br><br>
<input id="tur" placeholder="T√ºr (Koyun, Ko√ß, Kuzu)"><br><br>
<input id="kilo" type="number" placeholder="ƒ∞lk Kilo"><br><br>
<button onclick="hayvanEkle()">Kaydet</button>
</div>

</div>

<!-- ALT MENU -->
<div class="bottomNav">
<button onclick="panelAc('home')">Ana Sayfa</button>
<button onclick="panelAc('qr')">Tara</button>
<button onclick="panelAc('ekle')">Ekle</button>
</div>

<script>

const API="https://script.google.com/macros/s/AKfycbwUhg_knEiRUulKxjzbdVRQXX6qFa9ypzhkUDCV8miaoOnggHvr4ADLMeTvSR6H0XA_/exec";

/* PANEL */
function panelAc(p){

homePanel.classList.add("hidden");
qrPanel.classList.add("hidden");
eklePanel.classList.add("hidden");

if(p=="home") homePanel.classList.remove("hidden");
if(p=="qr"){ 
qrPanel.classList.remove("hidden");
kamerayiBaslat();
}
if(p=="ekle") eklePanel.classList.remove("hidden");
}

/* DASHBOARD */
async function dashboard(){

const res=await fetch(API,{method:"POST",body:JSON.stringify({tip:"tumHayvanlar"})});
const data=await res.json();

let toplam=0,koyun=0,koc=0,kuzu=0;
let kesimHTML="";
let asiHTML="";

data.forEach(h=>{

if(h.durum!="KESIM"){
toplam++;
}

if(h.tur=="Koyun") koyun++;
if(h.tur=="Ko√ß") koc++;
if(h.tur=="Kuzu") kuzu++;

if(h.durum=="KESIM"){
kesimHTML+=`
<div class="item kesimItem">
<b>${h.qr}</b><br>
√ñnceki: ${h.ilkKilo} kg ‚Üí ≈ûimdi: ${h.sonKilo} kg<br>
Kilo Kaybƒ± (${h.fark} kg)
</div>`;
}

if(h.sonrakiAsi && h.sonrakiAsi!="-"){
asiHTML+=`
<div class="item asiItem">
<b>${h.qr}</b><br>
${h.sonrakiAsi}
</div>`;
}

});

toplam.innerText=toplam;
koyun.innerText=koyun;
koc.innerText=koc;
kuzu.innerText=kuzu;

kesimListe.innerHTML=kesimHTML;
asiListe.innerHTML=asiHTML;

}

/* QR */
let html5Qr;

function kamerayiBaslat(){
html5Qr=new Html5Qrcode("reader");
html5Qr.start(
{ facingMode:"environment" },
{ fps:10, qrbox:250 },
(qrCodeMessage)=>{
alert("Bulundu: "+qrCodeMessage);
kamerayiKapat();
}
);
}

function kamerayiKapat(){
if(html5Qr){
html5Qr.stop().then(()=>{});
}
qrPanel.classList.add("hidden");
homePanel.classList.remove("hidden");
}

/* EKLE */
async function hayvanEkle(){
await fetch(API,{
method:"POST",
body:JSON.stringify({
tip:"hayvanEkle",
qr:qr.value,
kupe:kupe.value,
tur:tur.value,
kilo:kilo.value
})
});
alert("Kaydedildi");
dashboard();
panelAc("home");
}

dashboard();

</script>

</body>
</html>
